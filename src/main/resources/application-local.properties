# ========================================
# Configuración para entorno Local
# ========================================
# Para usar este perfil: SPRING_PROFILES_ACTIVE=local

# Nombre de la aplicación
spring.application.name=ventas-service

# Puerto del servicio
server.port=8083

# ========================================
# BASE DE DATOS (H2 en memoria)
# ========================================
spring.datasource.url=jdbc:h2:mem:ventasdb;MODE=MySQL;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# Habilitar consola H2
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# JPA / Hibernate
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.sql.init.mode=never

# Flyway
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.validate-on-migrate=true
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=1

# ========================================
# LOGGING
# ========================================
logging.level.root=INFO
logging.level.unrn=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.boot.web=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.security.web=DEBUG
logging.level.org.springframework.security.oauth2=DEBUG
logging.level.org.flywaydb=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n

# ========================================
# SEGURIDAD - OAuth2 JWT (Keycloak)
# ========================================
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:9090/realms/videoclub

# ========================================
# RabbitMQ
# ========================================
spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest
spring.rabbitmq.publisher-confirm-type=correlated
spring.rabbitmq.publisher-returns=true
spring.rabbitmq.template.mandatory=true

rabbitmq.event.movie.queue.name=ventas.movie.queue
rabbitmq.event.movie.routing-key=Movie.#
rabbitmq.ventas.events.exchange=ventas.events
rabbitmq.ventas.compra.confirmada.routing-key=ventas.compra.confirmada
rabbitmq.catalogo.events.exchange=catalogo.events
rabbitmq.ventas.stock.rechazado.queue=ventas.q.catalogo-stock-rechazado
rabbitmq.catalogo.stock.rechazado.routing-key=catalogo.stock.rechazado
rabbitmq.ventas.retry.exchange=ventas.retry.exchange
rabbitmq.ventas.dlx.exchange=ventas.dlx.exchange
rabbitmq.ventas.stock.rechazado.retry.queue=ventas.q.catalogo-stock-rechazado.retry
rabbitmq.ventas.stock.rechazado.retry.routing-key=ventas.stock.rechazado.retry
rabbitmq.ventas.stock.rechazado.retry.ttl-ms=10000
rabbitmq.ventas.stock.rechazado.dlq.queue=ventas.q.catalogo-stock-rechazado.dlq
rabbitmq.ventas.stock.rechazado.dlq.routing-key=ventas.stock.rechazado.dlq
rabbitmq.ventas.stock.rechazado.max-retries=3
rabbitmq.publisher.confirm-timeout-ms=5000
rabbitmq.publisher.strict-confirms=false

# ========================================
# Outbox
# ========================================
ventas.outbox.scheduler.enabled=true
ventas.outbox.scheduler.delay-ms=3000
ventas.outbox.max-attempts=10
ventas.outbox.retry.base-delay-ms=2000

# Projection bootstrap
ventas.catalogo.base-url=http://localhost:8081
ventas.catalogo.page-size=200
ventas.bootstrap.internal-token=local-bootstrap-token
